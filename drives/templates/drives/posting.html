<!-- https://developers.google.com/maps/documentation/directions/intro#DirectionsResponses -->
{% extends 'RideOn/base.html' %}

{% block title %} Ride Posting {% endblock %}

{% block content %}
    <div class="container">
        <div class="row" style="height: 60px;">
                {{drive.title}}
        </div>
        <div class="row">
            <div class="col-6">
                <p>Route {{drive.start_location}} {{drive.end_location}}</p>
                <div id="map" style="height: 100%; width: 300px;"></div>
                <div id="startx">{{drive.start_location.coordinates_x}}</div>
                <div id="starty">{{drive.start_location.coordinates_y}}</div>
                <div id="endx">{{drive.end_location.coordinates_x}}</div>
                <div id="endy">{{drive.end_location.coordinates_y}}</div>
                <div id="travel_time">{{drive.time}}</div>
                <script>

                    function initMap() {
                        var start_coordinates = { lat: parseFloat(document.getElementById('starty').innerText), lng: parseFloat(document.getElementById('startx').innerText) };
                        var end_coordinates = { lat: parseFloat(document.getElementById('endy').innerText), lng: parseFloat(document.getElementById('endx').innerText) };

                        var map = new google.maps.Map(document.getElementById('map'), {
                            zoom: 10,
                            center: start_coordinates
                        });

                        var marker_start = new google.maps.Marker({
                            position: start_coordinates,
                            map: map,
                            title: 'To Be Improved'
                        });

                        var marker_end = new google.maps.Marker({
                            position: end_coordinates,
                            map: map,
                            title: 'To Be Improved'
                        });

                        var directionsDisplay = new google.maps.DirectionsRenderer();
                        var directionsService = new google.maps.DirectionsService();

                        directionsDisplay.setMap(map)
                        // can also add waypoits here
                        // can also add duration information if add the travel time. but it sounds boring atm.
                        var request = {
                            origin: start_coordinates,
                            destination: end_coordinates,
                            travelMode: 'DRIVING'
                        };

                        directionsService.route(request, function(result, status){
                            if (status == "OK"){
                                directionsDisplay.setDirections(result);
                            }
                        });
                        
                    }
                </script>
                <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDY7BlSzTYJKwTNrObrU7so714CJgF3Uhc&callback=initMap">
                </script>

                <p>passengers: {{drive.passengers.objects}}</p>
            </div>
            <div class="col-6">
                <p>Driver: {{drive.driver}}</p>
                <p>Date: {{drive.date_time}}</p>
                <p>Cost: {{drive.min_cost}}$ - {{drive.max_cost}}$</p>
                <p>Payment: {{drive.payment_method}}</p>
                <p>Max Passangers: {{drive.max_passengers}}</p>
                <p>Vehicle: {{drive.car_description}}</p>
                <p>Luggage Capacity: {{drive.luggage_description}}</p>
                <p>Description: {{drive.description}}</p>
                <p>Location: {{drive.start_location.coordinates_x}}</p>

            </div>
        </div>
    </div>

{% endblock %}